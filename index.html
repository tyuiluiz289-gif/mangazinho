<!doctype html>

<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#0b1220" />
  <title>Mangazinho</title>  <!-- Manifest + √çcones (paths corrigidos para raiz) -->  <link rel="manifest" href="./manifest.webmanifest">
  <link rel="icon" sizes="192x192" href="./icon-192.png">
  <link rel="icon" sizes="512x512" href="./icon-512.png">
  <link rel="apple-touch-icon" href="./icon-192.png">  <style>
    :root{--bg:#0b1220;--card:#0f172a;--ink:#e5e7eb;--muted:#9ca3af;--cta:#18e6b5}
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif}
    header{position:sticky;top:0;z-index:10;background:rgba(11,18,32,.9);backdrop-filter:blur(8px);display:flex;gap:.6rem;align-items:center;padding:.6rem 1rem;border-bottom:1px solid rgba(255,255,255,.08)}
    header h1{margin:0;font-size:1.05rem;letter-spacing:.4px}
    header .spacer{flex:1}
    .icon{background:transparent;border:1px solid rgba(255,255,255,.12);border-radius:12px;color:var(--ink);padding:.45rem}
    .icon:hover{background:rgba(255,255,255,.06)}
    main.container{max-width:1000px;margin:0 auto;padding:1rem}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:.75rem}
    .card{background:var(--card);border:1px solid rgba(255,255,255,.12);border-radius:14px;padding:.75rem}
    .sub{color:var(--muted);font-size:.85rem}
    .row{display:flex;gap:.5rem;align-items:center}
    .btn{background:var(--cta);color:#001419;border:0;border-radius:12px;padding:.55rem .8rem;font-weight:700}
    .btn.secondary{background:transparent;color:var(--ink);border:1px solid rgba(255,255,255,.18)}
    .fab{position:fixed;right:1rem;bottom:1rem;padding:.8rem 1rem;border-radius:16px}
    dialog{border:0;border-radius:16px;background:#0f172a;color:var(--ink);padding:1rem;max-width:600px;box-shadow:0 20px 60px rgba(0,0,0,.35)}
    dialog::backdrop{background:rgba(0,0,0,.45)}
    input,textarea{width:100%;background:#0b1220;color:var(--ink);border:1px solid rgba(255,255,255,.18);border-radius:10px;padding:.6rem}
    label.hint{display:block;color:var(--muted);font-size:.85rem;margin:.35rem 0}
    /* Reader */
    .reader{position:fixed;inset:0;background:#000;display:none;flex-direction:column}
    .reader.show{display:flex}
    .rbar{display:flex;gap:.4rem;align-items:center;padding:.5rem;background:rgba(0,0,0,.6);color:#fff}
    .rbody{flex:1;overflow:auto}
    .page{display:block;max-width:100%;margin:0 auto}
    .nav{display:flex;gap:.6rem;justify-content:center;padding:.6rem;background:#000}
    .crumb{opacity:.8}
    .hidden{display:none}
  </style></head>
<body>
  <header>
    <!-- caminho corrigido para raiz -->
    <img src="./icon-192.png" alt="logo" width="28" height="28" style="border-radius:6px" />
    <h1>Mangazinho</h1>
    <div class="spacer"></div>
    <button class="icon" id="installBtn" title="Instalar PWA">‚¨áÔ∏è</button>
    <button class="icon" id="exportBtn" title="Exportar">üì§</button>
    <button class="icon" id="importBtn" title="Importar">üì•</button>
  </header>  <main class="container">
    <div class="toolbar"><button class="btn" id="newSeriesBtn">+ Nova S√©rie</button></div>
    <div class="grid" id="seriesGrid"><div class="sub">Nenhuma s√©rie ainda.</div></div>
    <p class="sub">Tudo fica salvo <b>no seu dispositivo</b>.</p>
  </main><button class="fab btn" id="quickNew">+ S√©rie</button>

  <!-- Dialog Nova S√©rie -->  <dialog id="seriesDialog">
    <form method="dialog" class="modal">
      <h3>Nova s√©rie</h3>
      <input id="seriesTitle" placeholder="T√≠tulo da s√©rie" />
      <label class="hint">Capa (opcional): <input id="seriesCover" type="file" accept="image/*" /></label>
      <div class="row" style="justify-content:flex-end">
        <button class="btn secondary" value="cancel">Cancelar</button>
        <button id="saveSeries" class="btn" value="ok">Salvar</button>
      </div>
    </form>
  </dialog>  <!-- Dialog Novo Cap√≠tulo -->  <dialog id="chapterDialog">
    <form method="dialog" class="modal">
      <h3>Novo cap√≠tulo</h3>
      <input id="chapterTitle" placeholder="T√≠tulo do cap√≠tulo" />
      <label class="hint">P√°ginas (ordem pelo nome do arquivo): <input id="chapterFiles" type="file" accept="image/*" multiple /></label>
      <div class="row" style="justify-content:flex-end">
        <button class="btn secondary" value="cancel">Cancelar</button>
        <button id="saveChapter" class="btn" value="ok">Salvar cap√≠tulo</button>
      </div>
    </form>
  </dialog>  <!-- Reader -->  <section class="reader" id="reader">
    <div class="rbar">
      <button class="icon" id="closeReader">‚¨ÖÔ∏è</button>
      <div class="crumb" id="readerCrumb">S√©rie / Cap√≠tulo</div>
      <div class="spacer"></div>
      <button class="icon" id="delChapter">üóëÔ∏è</button>
      <button class="icon" id="prevChapter">‚èÆÔ∏è</button>
      <button class="icon" id="nextChapter">‚è≠Ô∏è</button>
    </div>
    <div class="rbody"><img id="pageImg" class="page" alt="p√°gina" /></div>
    <div class="nav">
      <button id="prevPage">‚óÄ P√°gina</button>
      <span id="pageInfo" class="crumb"></span>
      <button id="nextPage">P√°gina ‚ñ∂</button>
    </div>
  </section>  <!-- Storage multi-cap√≠tulos opcional -->  <script src="./mangazinho-multichapter.js"></script>  <!-- Registro do Service Worker (escopo correto p/ GitHub Pages) -->  <script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('./sw.js', { scope: './' })
        .then(reg => console.log('[SW] registrado em:', reg.scope))
        .catch(err => console.error('[SW] erro registro:', err));
    });
  }
  </script>  <!-- App logic m√≠nima (placeholder). Se voc√™ j√° tem sua l√≥gica/IndexedDB, mantenha-a e remova este bloco. -->  <script>
  // Exemplo extremamente simplificado s√≥ para manter a p√°gina funcional.
  // Integre aqui sua l√≥gica real (IndexedDB) ou use window.Store (localStorage) se preferir o helper.

  const seriesGrid = document.getElementById('seriesGrid');
  const seriesDialog = document.getElementById('seriesDialog');
  const chapterDialog = document.getElementById('chapterDialog');
  const reader = document.getElementById('reader');
  const pageImg = document.getElementById('pageImg');
  const pageInfo = document.getElementById('pageInfo');
  const readerCrumb = document.getElementById('readerCrumb');

  let currentSeries = null, currentChapter = null, pages = [], pageIndex = 0;

  // Se existir o Store (helper), usa ele. Caso n√£o, mant√©m mem√≥ria simples s√≥ pra demo.
  const hasStore = !!window.Store;

  document.getElementById('newSeriesBtn').onclick = () => seriesDialog.showModal();
  document.getElementById('quickNew').onclick = () => seriesDialog.showModal();
  document.getElementById('saveSeries').onclick = (e) => {
    e.preventDefault();
    const title = document.getElementById('seriesTitle').value.trim() || 'Sem t√≠tulo';
    if (hasStore) {
      currentSeries = Store.upsertSeries({ title });
    } else {
      currentSeries = 'demo-series';
    }
    seriesDialog.close();
    renderSeries([{ id: currentSeries, title }]);
  };

  function renderSeries(list){
    seriesGrid.innerHTML = '';
    list.forEach(s => {
      const el = document.createElement('div');
      el.className = 'card';
      el.innerHTML = `<div class="title">${s.title}</div>
      <div class="sub">0 cap√≠tulos</div>
      <div class="row" style="margin-top:.5rem">
        <button class="btn secondary" data-id="${s.id}">+ Cap√≠tulo</button>
      </div>`;
      el.querySelector('button').onclick = () => {
        currentSeries = s.id; chapterDialog.showModal();
      };
      seriesGrid.appendChild(el);
    });
  }

  document.getElementById('saveChapter').onclick = async (e) => {
    e.preventDefault();
    const title = document.getElementById('chapterTitle').value.trim() || 'Cap√≠tulo';
    const files = Array.from(document.getElementById('chapterFiles').files || []);
    files.sort((a,b)=> a.name.localeCompare(b.name, undefined, { numeric:true }));

    // Cria cap√≠tulo e salva p√°ginas (Store) ou mant√©m na mem√≥ria demo.
    if (hasStore && currentSeries){
      const chapId = Store.upsertChapter({ seriesId: currentSeries, number: Date.now(), title });
      const arr = await Promise.all(files.map(async (f, i) => ({ index: i+1, src: URL.createObjectURL(f) })));
      Store.savePages(chapId, arr);
      openReader(title, arr);
    } else {
      pages = await Promise.all(files.map(async (f, i) => ({ index: i+1, src: URL.createObjectURL(f) })));
      openReader(title, pages);
    }
    chapterDialog.close();
  };

  // Reader controls
  document.getElementById('closeReader').onclick = () => reader.classList.remove('show');
  document.getElementById('prevPage').onclick = () => go(-1);
  document.getElementById('nextPage').onclick = () => go(1);

  function openReader(chapterTitle, arr){
    pages = arr; pageIndex = 0; reader.classList.add('show');
    readerCrumb.textContent = `Cap√≠tulo / ${chapterTitle}`;
    renderPage();
  }

  function renderPage(){
    if(!pages.length) return; const p = pages[pageIndex];
    pageImg.src = p.src; pageInfo.textContent = `${pageIndex+1} / ${pages.length}`;
  }
  function go(step){
    const i = pageIndex + step; if(i<0 || i>=pages.length) return; pageIndex = i; renderPage();
  }
  </script></body>
</html>
